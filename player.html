function playStream(resolution) {
  const src = resolution === "master"
    ? "https://stream.wproject.web.id/master.m3u8"
    : `${base}/${resolution}/index.m3u8`;

  const bust = `?t=${Date.now()}`; // cegah cache
  const url = src + bust;

  statusEl.textContent = `‚ñ∂Ô∏è Memutar ${resolution.toUpperCase()}...`;

  if (Hls.isSupported()) {
    if (window.hls) window.hls.destroy();
    const hls = new Hls({
      maxBufferLength: 5,
      maxMaxBufferLength: 10,
      liveSyncDurationCount: 2,
      enableWorker: true,
      fragLoadingTimeOut: 5000,
      manifestLoadingTimeOut: 5000,
      manifestLoadingMaxRetry: 10,
      fragLoadingMaxRetry: 5,
      fragLoadingRetryDelay: 1000,
    });
    window.hls = hls;

    hls.loadSource(url);
    hls.attachMedia(videoEl);
    hls.on(Hls.Events.MANIFEST_PARSED, () => videoEl.play());

    // auto recover bila error
    hls.on(Hls.Events.ERROR, function (event, data) {
      if (data.fatal) {
        switch (data.type) {
          case Hls.ErrorTypes.NETWORK_ERROR:
            statusEl.textContent = "üîÅ Reconnecting...";
            hls.startLoad();
            break;
          case Hls.ErrorTypes.MEDIA_ERROR:
            statusEl.textContent = "‚ö†Ô∏è Memperbaiki media...";
            hls.recoverMediaError();
            break;
          default:
            statusEl.textContent = "‚ùå Fatal error, reload...";
            setTimeout(() => playStream(resolution), 3000);
            break;
        }
      }
    });
  } else if (videoEl.canPlayType("application/vnd.apple.mpegurl")) {
    videoEl.src = url;
    videoEl.addEventListener("loadedmetadata", () => videoEl.play());
  } else {
    statusEl.textContent = "‚ö†Ô∏è Browser tidak mendukung HLS.";
  }
}
